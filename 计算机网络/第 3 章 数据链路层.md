# 目录

- [使用点对点信道的数据链路层](#3.1)  
    - [数据链路和帧](#3.1.1)
    - [三个基本问题](#3.1.2)
- [点对点协议 PPP](#3.2)
    - [PPP 协议的特点](#3.2.1)
    - [PPP 协议的帧格式](#3.2.2)
    - [PPP 协议的工作状态](#3.2.3)
- [使用广播信道的数据链路层](#3.3)
    - [局域网的数据链路层](#3.3.1)
    - [CSMA/CD 协议](#3.3.2)
    - [使用集线器的星形拓扑](#3.3.3)
    - [以太网的信道利用率](#3.3.4)
    - [以太网的 MAC 层](#3.3.5)
- [扩展的以太网](#3.4)
    - [在物理层扩展以太网](#3.4.1)
    - [在数据链路层拓展以太网](#3.4.2)
    - [虚拟局域网](#3.4.3)
- [高速以太网](#3.5)
    - [100BASE-T 以太网](#3.5.1)
    - [吉比特以太网](#3.5.2)
    - [10 吉比特以太网（10GE）和更快的以太网](#3.5.3)
  
---  

# 数据链路层

数据链路层使用的信道主要有以下两种类型  

- 点对点信道
    这种信道使用一对一的点对点通信方式。  
- 广播信道
    这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

在网络层我们讨论的是怎么样将分组从一个网络通过路由器，转发到另一个网络中。而在数据链路层中我们讨论的是怎么样将一个分组从一台主机传送到另一台主机。  

具体过程如下：  

![主机H1向H2发送数据图](../public/network/datalink1.png)  

![数据链路层地位图](../public/network/datalink2.png)  

![数据链路层流向图](../public/network/datalink3.png)  

---

# <span id="3.1">使用点对点信道的数据链路层

## <span id="3.1.1"> 数据链路和帧

**链路** (link) 是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。一条链路只是一条通路的一个组成部分。  

**数据链路** (data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。  
现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件。  
一般的适配器都包括了数据链路层和物理层这两层的功能。  

**在点对点信道的数据链路层的协议数据单元是帧。**    

总的来说就是将协议加在链路上，而在物理层当中传输的只是比特流，不用考虑协议的问题。  

![使用点对点信道的数据链路层图](../public/network/point.png)  

由图可知点对点信道的数据链路层在通信时的主要步骤：  

1. 结点 A 的数据链路层把网络层交下来的 IP 数据报添加首部和尾部封装成帧。  
2. 结点 A 把封装好的帧发送给结点 B 的数据链路层。  
3. 若结点 B 的数据收到的帧无差错，则从收到的帧提取出 IP 数据报交给上面的网络层；否则丢弃这个帧。 

## <span id="3.1.2">三个基本问题

在数据链路层中我们使用的协议有很多，但总的来说有三个基本问题是共同的。即：**封装成帧**、**透明传输**、**差错检测**。  

### 封装成帧

封装成帧 (framing) 就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限。  
首部和尾部的一个重要作用就是进行帧定界。  

![图3-4](../public/network/3-4.png)

当数据是由可打印的 ASCII 码组成的文本文件时，帧定界可以使用特殊的帧定界符。  
控制字符 SOH (Start Of Header) 放在一帧的最前面，表示帧的首部开始。另一个控制字符 EOT (End Of Transmission) 表示帧的结束。  

![图3-5](../public/network/3-5.png)  

### 透明传输

如果数据中的某个字节的二进制代码恰好和 SOH 或 EOT 一样，数据链路层就会错误地“找到帧的边界”。  

![图3-6](../public/network/3-6.png)  

解决方法：**字节填充** (byte stuffing) 或**字符填充** (character stuffing)。  
发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC” (其十六进制编码是 1B)。  
接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。  
如果转义字符也出现在数据当中，那么应在转义字符前面插入一个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个。  

![图3-7](../public/network/3-7.png)

### 差错检测

在传输过程中可能会产生比特差错：1 可能会变成 0 而 0 也可能变成 1。  
在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER (Bit Error Rate)。  
误码率与信噪比有很大的关系。  
为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。  

在数据链路层广泛使用的是**循环冗余检验** CRC （Cyclic Redundancy Check）的检错技术。原理如下:  

---

#### 循环冗余检验

在发送端，先把数据划分为组。假定每组 k 个比特。  
假设待传送的一组数据 M = 101001（现在 k = 6）。我们在 M 的后面再添加供差错检测用的 n 位冗余码一起发送。  
  
**冗余码的计算**：用二进制的模 2 运算进行 2n 乘 M 的运算，这相当于在 M 后面添加 n 个 0。  
得到的 (k + n) 位的数除以事先选定好的长度为 (n + 1) 位的除数 P，得出商是 Q 而余数是 R，余数 R 比除数 P 少 1 位，即 R 是 n 位。  
  
将余数 R 作为冗余码拼接在数据 M 后面发送出去。  

eg:  
现在 k = 6, M = 101001。  
设 n = 3, 除数 P = 1101，  
被除数是 2n^M = 101001000。  
模 2 运算的结果是：商 Q = 110101，  
余数 R = 001。  
把余数 R 作为冗余码添加在数据 M 的后面发送出去。发送的数据是：2nM + R。即：101001001，共 (k + n) 位。  

![图3-8](../public/network/3-8.png)
  
在数据后面添加的冗余码称为**帧检验序列** FCS (Frame Check Sequence)。  
循环冗余检验 CRC 和帧检验序列 FCS 并不是一个概念。CRC 是一种常用的检错方法，但不代表只能使用这一种方法。而 FCS 是使用检错方法得到的冗余码，是添加在数据后面和数据一起发送的。  
  
接收端再根据 R 的值，判断这个帧有没有出现差错。  

但这种方法并不能判断出是哪一比特出现差错, 即使用 CRC 只能做到**无差错接受**, 并不能做到**可靠传输**。要想做到可靠传输，就必须再加上确认和重传机制。  
我们讨论的数据链路层协议都不是可靠的协议。可靠的协议可以交给高层来控制。  
  
# <span id="3.2"> 点对点协议

目前在点对点链路中，使用的是点对点协议 PPP（Point-to-Point Protocol）。应用场合在我们现实成活中处处可见，当我们使用拨号接入互联网时,用户与 ISP 进行通信时所使用的协议就是 PPP 。  

![图3-9](../public/network/3-9.png)

## <span id="3.2.1">PPP 协议的特点

### PPP 协议应满足的需求

- [ ] 代办项  
  
### PPP 不需要的功能

- 纠错  
- 流量控制  
- 序号  
- 多点线路  
- 半双工或单工链路  
  
### PPP 的组成

- 一个将 IP 数据报封装到串行链路的方法。  
- 链路控制协议 LCP (Link Control Protocol)。  
- 网络控制协议 NCP (Network Control Protocol)。  

## <span id="3.2.2">PPP 协议的帧格式

PPP 帧的首部和尾部分别为 4 个字段和 2 个字段。标志字段 F，地址字段 A，地址字段实际上并不起作用。控制字段 C。如图：  

![图3-10](../public/network/3-10.png)
  
当 PPP 用在同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的做法一样）。  
当 PPP 用在异步传输时，就使用一种特殊的字符填充法。  
  
**字符填充**：将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列 (0x7D, 0x5E)。若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列 (0x7D, 0x5D)。若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变。  
  
**零比特填充**：在发送端，只要发现有 5 个连续 1，则立即填入一个 0。接收端对帧中的比特流进行扫描。每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除。  

### <span id="3.2.3">PPP 协议的工作状态

当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。  
PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。  
这些分组及其响应选择一些 PPP 参数，并进行网络层配置，NCP 给新接入的 PC 机分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机。  
通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。  
可见，PPP 协议已不是纯粹的数据链路层的协议，它还包含了物理层和网络层的内容。  
  
![图3-11](../public/network/3-11.png)  
  
# <span id="3.3">使用广播信道的数据链路层

